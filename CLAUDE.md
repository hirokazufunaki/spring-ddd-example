# CLAUDE.md

このファイルは、このリポジトリでコードを操作する際のClaude Code (claude.ai/code) へのガイダンスを提供します。

## 言語設定

**重要**: このプロジェクトでは、原則として日本語でドキュメントを生成してください。コメント、README、設計書などすべてのドキュメントは日本語で作成します。

## プロジェクト概要

ドメイン駆動設計（DDD）とヘキサゴナルアーキテクチャの原則を使用したシンプルなタスク管理サービスAPIのSpring Bootアプリケーションです。ユーザーとタスクの基本的なCRUD操作を管理します。

## 開発コマンド

### ビルドとテスト
- `./gradlew build` - プロジェクト全体をビルド
- `./gradlew test` - すべてのテストを実行
- `./gradlew bootRun` - アプリケーションをローカルで実行
- `./gradlew clean` - ビルド成果物をクリーン

### 単体テスト実行
- `./gradlew test --tests "ClassName"` - 特定のテストクラスを実行
- `./gradlew test --tests "ClassName.methodName"` - 特定のテストメソッドを実行

## アーキテクチャ概要

コードベースは関心の分離を厳密に行う階層化されたヘキサゴナルアーキテクチャに従います：

### ドメイン層 (`domain/`)
- **集約**: `User`と`Task` - 独自の境界を持つコアビジネスエンティティ
- **値オブジェクト**: `UserId`, `UserName`, `Email`, `TaskId`, `TaskName`, `TaskStatus` - 不変なドメイン概念
- **リポジトリインターフェース**: 実装詳細なしでデータ永続化の契約を定義
- **共有カーネル**: 共通のドメイン例外とユーティリティ

### アプリケーション層 (`application/`)
- **アプリケーションサービス**: ユースケースを統制 (`UserApplicationService`, `TaskApplicationService`)
- **DTO**: 入出力用のCommandとResultオブジェクト (`CreateUserCommand`, `UserResult`など)
- **ビジネスロジックなし** - ドメインオブジェクトに委譲

### インフラストラクチャ層 (`infrastructure/`)
- **JPA永続化**: エンティティマッピング、リポジトリ実装、アダプター
- **マッパー**: ドメインオブジェクトとJPAエンティティ間の変換
- **アダプター**: Spring Data JPAを使用してドメインリポジトリインターフェースを実装

### プレゼンテーション層 (`presentation/`)
- **RESTコントローラー**: ユーザーとタスク用のHTTPエンドポイント
- **リクエスト/レスポンスDTO**: 変換メソッド付きのWebレイヤーデータ契約
- **例外処理**: 一貫したエラーレスポンスのためのグローバル例外ハンドラー

## 主要パターン

### パッケージ構造
- 各集約（User、Task）はすべての層で独自のパッケージ構造を持つ
- ドメインでインターフェース、インフラストラクチャで実装を行うリポジトリパターン
- 層間のオブジェクト変換用のマッパーパターン

### データフロー
1. **RESTリクエスト** → **コントローラー** → **アプリケーションサービス** → **ドメインリポジトリインターフェース** → **リポジトリアダプター** → **JPAリポジトリ**
2. ドメインオブジェクトはインフラストラクチャ境界でのみJPAエンティティと相互変換される
3. プレゼンテーションDTOは変換用の拡張関数（`toCommand()`）とファクトリ関数（`from()`）を持つ

## 重要な規約

- Kotlin with Spring Boot 3.5.6とJava 21を使用
- すべてのドメインロジックは集約ルートと値オブジェクトに配置
- リポジトリインターフェースはドメイン層で定義し、インフラストラクチャで実装
- コマンドは内向きに、結果は外向きに層を通って流れる
- JPAエンティティはドメインエンティティとは分離し、明示的なマッピングを行う